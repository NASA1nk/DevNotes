# Service Mesh

服务网格：服务间通信的专用基础设施层

- 它负责通过包含现代云原生应用程序的复杂服务拓扑来可靠地传递请求
- 服务网格通常通过一组轻量级网络代理来实现，这些代理与应用程序代码一起部署，而不需要感知应用程序本身
- 服务网格作为**sidecar**运行，对应用程序来说是透明，所有应用程序间的流量都会通过它，所以对应用程序流量的控制都可以在Service Mesh中实现

**服务网格的特点**

- 应用程序间通讯的中间层
- 轻量级网络代理
- 应用程序无感知
- 解耦应用程序的重试/超时、监控、追踪和服务发现

## 为什么使用服务网格

在云原生架构下，容器的使用给予了异构应用程序的更多可行性，Kubernetes增强的应用的横向扩容能力

- 用户可以快速的编排出复杂环境、复杂依赖关系的应用程序
- 同时开发者又无须过分关心应用程序的监控、扩展性、服务发现和分布式追踪这些繁琐的事情而专注于程序开发，赋予开发者更多的创造性

**可以说服务网格很大程度上是一种新一代的微服务架构**，它解决了微服务中网络层操控性、弹性、可视性的问题

- 服务网格并没有带来新功能，它是用于解决其他工具已经解决过的问题，只不过这次**是在云原生的Kubernetes环境下的实现**
- 在传统的MVC三层Web应用程序架构下，服务之间的通讯并不复杂，在应用程序内部自己管理即可，但是在现今的复杂的大型网站情况下，单体应用被分解为众多的微服务，服务之间的依赖和通讯十分复杂

**通信逻辑**

- 在大多数情况下，开发人员将通信逻辑作为服务的一部分来构建
- **通信逻辑是处理入站或出站请求的任何代码**，重试逻辑，超时，甚至可能是流量路由
- 无论何时服务A调用服务B，请求都要经过这个通信逻辑，这个逻辑决定如何处理这个请求

**服务网格所做的是**

- 将这种通信逻辑、重试、超时等从单个服务中分离出来，并将其移到一个单独的基础设施层
- 在服务网格的情况下，**基础设施层是一个网络代理的阵列**
- 这些网络代理的集合（每个服务实例旁边都有一个）处理服务之间的所有通信逻辑，称这些代理为**sidecar**

服务网格控制平面以这样一种方式配置代理，即它们透明地拦截所有入站和出站请求，这些代理的集合（基础设施层）形成了一个网络网格，**称为服务网格**

服务网格提供了一种**一致的方式来连接、保护和观察微服务**

服务网格内的代理**捕获了网格内所有通信的请求和指标**，每一次失败、每一次成功的调用、重试或超时都可以被捕获、可视化，并发出警报

可以根据请求属性做出决定，例如，可以检查入站（或出站）请求并编写规则，将所有具有特定头值的请求路由到不同的服务版本

