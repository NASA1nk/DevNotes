# ClickHouse

ClickHouse 是 Yandex（俄罗斯最大的搜索引擎）开源的一个**用于实时数据分析的基于列存储的数据库**

- 列存储
- 实时数据分析
  
> ClickHouse处理数据的速度比传统方法快100-1000 倍
> 
> ClickHouse 的性能超过了目前市场上可比的面向列的DBMS，每秒钟每台服务器每秒处理数亿至十亿多行和数十千兆字节的数据

## 特性

- 快速：ClickHouse会充分利用所有可用的硬件，以尽可能快地处理每个查询
  - 单个查询的峰值处理性能超过每秒2TB（解压缩后，仅使用的列）
  - 在分布式设置中，读取是在健康副本之间自动平衡的，以避免增加延迟
- 容错：ClickHouse支持多主机异步复制，并且可以跨多个数据中心进行部署
  - 所有节点都相等，这可以避免出现单点故障，单个节点或整个数据中心的停机时间不会影响系统的读写可用性
- 可伸缩：ClickHouse可以在垂直和水平方向上很好地缩放
  - ClickHouse易于调整以在具有数百或数千个节点的群集上或在单个服务器上，甚至在小型虚拟机上执行
  - 当前每个单节点安装的数据量超过数万亿行或数百兆兆字节
- 易用：ClickHouse简单易用，开箱即用
  - 简化了所有数据处理：将所有结构化数据吸收到系统中，并且立即可用于构建报告
  - SQL允许表达期望的结果，而无需涉及某些DBMS中可以找到的任何自定义非标准API
- 充分利用硬件：ClickHouse与具有相同的可用I/O吞吐量和CPU容量的传统的面向行的系统相比，其处理典型的分析查询要快两到三个数量级
  - 列式存储格式允许在RAM中容纳更多热数据，从而缩短了响应时间
- 提高CPU效率：向量化查询执行涉及相关的SIMD处理器指令和运行时代码生成，处理列中的数据会提高CPU行缓存的命中率
- 优化磁盘访问：ClickHouse可以最大程度地减少范围查询的次数，从而提高了使用旋转磁盘驱动器的效率，因为它可以保持连续存储数据
- 最小化数据传输：ClickHouse使公司无需使用专门针对高性能计算的专用网络即可管理其数据

## OLAP

联机分析处理（On-Line Analytical Processing）

**应用场景**
- 绝大多数操作是读、极少更新甚至无需更新
- 读取大量行的数据，但是一次查询往往只关注少量列
- 无需事务的支持、数据一致性要求低，追求极致的速度
- 统计分析场景、多维度聚合查询


## 列式存储

- 列式数据库组织磁盘或内存中给定的连续列数据
- 基于列的存储方式，有助于减少**联机分析处理 (OLAP)** 的负载
  - 因为查询会涉及到列的一个子集，这些列有大量的行数，对于这类查询，使用列数据格式可以大大减少从磁盘到内存和从内存到寄存器的数据转换，可以有效地提高整个存储体系的吞吐量
- 列式存储可以使用一些基于每列的轻量级压缩算法，节省了空间，提升了IO性能

> 常见的列式存储有：Vertical、HBase等

**优点**
- 查询时只需读取涉及的列
- 任何列都可以做索引

相比于行式存储，列式存储在分析场景下有着许多优良的特性

- 分析场景中往往需要读大量行但是少数几个列
  - 在行存模式下，数据按行连续存储，所有列的数据都存储在一个block中，不参与计算的列在IO时也要全部读出，读取操作被严重放大
  - 而在列存模式下，只需要读取参与计算的列即可，极大的减低了IO cost，加速了查询
- 同一列中的数据属于同一类型，压缩效果显著
  - 列存往往有着高达十倍甚至更高的压缩比，节省了大量的存储空间，降低了存储成本
  - 更高的压缩比意味着更小的data size，从磁盘中读取相应数据耗时更短
- 自由的压缩算法选择
  - 不同列的数据具有不同的数据类型，适用的压缩算法也就不尽相同，可以针对不同列类型，选择最合适的压缩算法
  - 高压缩比，意味着同等大小的内存能够存放更多数据，系统cache效果更好

**缺点**
- 不适用于`Insert / Update`
- 不支持事务